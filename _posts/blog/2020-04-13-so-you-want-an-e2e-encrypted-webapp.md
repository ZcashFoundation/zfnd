---
layout: post
title: "So You Want to Build an End-to-End Encrypted Web App", aka, Musings on Long-term Identity
excerpt: "The software security model of the web does not lend itself to long term identities."
categories: blog
tags: [cryptography, web development, software security]
date: 2020-04-13
author: dconnolly
---


Long term identity really just bootstraps to trust SSOs/IDPs anyway. Rekey on auth?

Otherwise, per-meeting ID management, that gets thrown away at the end. TOFU on the channel that delivers the meeting information. Every participant is issued an unguessable, unforgeable participantID, that is used to moderate and authorize them for that meeting alone. Then everything is E2EE, bootstrapping from those per-meeting IDs. 

----

So it would be really nice if we could do end-to-end encrypted video calling like we do between devices like a desktop app for a mobile out in the browser where a web app is not the same type of app that you can install inversion on your desktop or on your iPhone or your Android phone a web app is Sir from a server and usually but not always is completely reloaded Andre served and reprocessed every time you load the page there's some cashing involved but usually every time you load the page is it sensibly you fetching the software to run your web app from an edge server not necessarily the server a server controlled by the people who wrote the app and downloading it and running that software inside the browser sandbox soap coming out of this Ram this affects how securely we can keep data that is stored in the browser app versus how security we can keep data that is stored in a mobile app or a desktop app in a desktop app or mobile app usually what happens on most modern Oasis there is a developer who has a key that is a tested to buy some signing Authority or certificate Authority or app store or something like that like the Apple store or the Google Play store or whatever or a package by a package distribution medium and they signed the package that you going to distribute that key that they sign it with has been attested to by the signing Authority and your show s trust the signing Authority it trust the Android trust the Google Play Store at West trustee App Store and apple you know Windows trust Microsoft Etc so when you install the package the software you get the package from wherever it could be distributed directly from the developer it could be distributed via ass or it could be distributed by a package repository or it could just lie really beat up a link on a web page you download this piece of software and your OS checks the signature it checks that Keith They supposedly signed by actually signed it and it checks that those keys are having a tested to buy the signing Authority that you already trust because the keys that you need to trust it or distributed with your OS exchange up to Apple change up to Google whatever change it to Microsoft therefore you can both trust that that software came from says that came from the developer and that developer is at least the keys that the developer used are trusted by the people who make your OS cool great and you do this every time I push an updates that software or you download the latest version of the software these checks and and also they check that not only that it came from who it says it came from and that though the people that do you say came from our trusted to some degree by the makers of your OS was going to try and run the software will also this particular block this particular version of the software is the thing that supposedly you're going to trust and install on your computer this gives us very nice guarantees about the security and Providence of the software to try on your computer one we don't have any of that for the web the closest thing that we have for that sort of software delivery security model is we what's the connection that we download this offer over but that's it and we only trust the nearest hop because we're trusting in TLS and you can trust in TLS when you're downloading sign software to but you for web you only trust in the connection and you're only trusting on the nearest top so if anyone can get on that connection between your computer and the the CDN for the serving the software from or whatever oh no they might serve you a different version of your web app and you trust it because the only thing you are trusting in is the TLs connection that's not right however even in mobile apps stop apps we are getting closer and closer to a instead of installing it once and trusting it forever and never updating it and updates coming in frequently and they are like a thing to pay attention to it's coming closer and closer to updating almost every time you use the app for example your Chrome browser for most modern browsers are called Evergreen because they update frequently you are almost always on the latest version of the app every time you restart your browser is almost almost guaranteed to be running a new version of the browser that was downloaded in the background and just ready to go as soon as you restarted similar for a lot of mobile apps a lot of them update very frequently including Chrome or your browser you're not running a new version of the software you're not downloading a new version of the software every time but you're running new versions of the software they're downloaded fresh from the internet frequently so there's sort of this confluence of installed apps like mobile apps and desktop app that can be signed and it tested coming closer to what you do when you download a webpage almost every time you run them you're running fresh software although you can check where it come from where is the web browser almost guarantee it's always the exception that you're not running for software because of cashing local cashing stuff but you don't have any guarantees but where the software came from you have a little bit of a guarantee okay so why do we care 4 apps like Zoom or other apps that you want to have long-term end-to-end encrypted do you want to have end-to-end encrypted Communications it requires you create an established and identity key the identity key establishes I am who I say I am at least on this device it's usually assigning keep are a public key pair of a signing key where you sign stuff and then a verifying key that other people can use to verify that only the person in control of this keep air can sign that thing and then you have a femoral key data that you can use per message per video call or something like that now the problem usually with doing this on web with doing an engine encryption at Cricket application via a web app is usually been that keep that identity keep hair has been long-term so for example with signal when you install signal on your phone it establishes a keep are here and you signed a bunch of blobs or whatever and you put your public key for your long-term ID on the public signal server so that other people who want to communicate with you can fetch it and pull it down your secret key data or signing key data stays on your device that keep hair will stay alive for a do you have signal installed on that device and the reason this work is that you want to die all your Communications back via hashing and ratcheting back to that public that long-term identity key because you want to tie the identity who you first start communicating with with all the messages that you exchange with them and you want to be able to detect if something happens to their keys something changes so you can find interceptions or something like that that is why it's generally harder to do these things securely on the web because it's harder to protect long-term secrets in a web browser because the entire platform is ephemeral the app is ephemeral the software that you download is ephemeral the communications that you're doing are several and a software level it's hard to keep something safe in the browser if the software you're relying on to keep it safe it's changing all the time every time you load the page there's many many opportunities for someone to fuk with your software because they picked one opportunity to man-in-the-middle your connection to the server and they're like oh that's the one time that you update your you know you're into an encrypted web app and you served it and you ran it and then they were at the pluck out your long-term secret identity key from browser storage or whatever and they will trade it and then the next time you load the page that you never see them again everything is back to normal but someone does exfiltrate you say you're an idiot key but 4 calls not long-term chat records do you need a long-term identity key especially if you are tying identity to an outside identity provider the identity provider is the one that's in charge of making sure that you are who you say you are and you are authorized to access and do stuff attesting to your even independent of an identity provider you could just be you who got access to a meeting just for that meaning and we're able to identify you and your access point like your you know Pursuit personalized meeting ID meaning code that should be a guess about Jimmy just for you and you shall be able to forge it you should not be able to produce on your own and what if you generate your ID Keys just for that meeting you are who you say you are and we trust that the person who got that meeting information is the person we intended to get information because we trust that channel on first use and then they can access the call generate their keys so that they can sign and verify that they are who they say they are and who they say they are is the person who had access to this data this access data and then they do all the antenna Christian stuff that were used to hide back to a per meeting identity manager of the manager of the meeting can manage those identities per meeting we could do all the encryption and then we could do signal protocol if we want we can do you know your smartly ratcheting meeting key for video calling and all that stuff we can boot people on a per-user identity that only exists for this call and then we throw it all the way at the end deep identity management all the key data all of that is thrown away at the end of the meeting there's nothing to protect there's nothing to trust after the meeting is over the only things that you trust are the software you downloaded for this one meaning and that the channel That You delivered at the meeting information over is trusted for this meeting if that's that seems a lot more amenable to being implemented in a web app because the only things that we need to trust our this version of the software that were running right now for the meeting  . this basically boils down to Tofu for the software they were running for this meeting and the channel that we deliver the meet the per participant meeting information over for this meeting. The trust is ephemeral the meeting is ephemeral the ID is ephemeral. for a lot of meetings this is perfectly acceptable. This is also our kin to our trust model of phone calls in the regular world: whoever is receiving your call is the person who has access to the phone number and then as soon as the call is over you're done. If someone else gets that phone number in the future then you either trust them or you don't for that call. if you want to tie these permitting identities to some other long-term I done these you can use your ass is Oprah better you can use your identity provider such as like your Google your G Suite accounts or you know your ldap manage accounts and then you can attest the / meeting ID keys Starbound to the identities that you must by definition be authorized and authenticated to be authorized to manage you suck but after the meeting is over you throw away those ID keys or if you have some integration you can log them overtime if you really care. But they are the point is they are generated a new / call and even this login with an SSL provider in a web app to do something in a call is like extremely well-established and very well supported.  if the meeting generation generate per user per participant IDs that are unguessable and on forgeable which we can do cryptographically then we can manage those users the way that we we do anyone that's attached to long-term identity if they're being misbehaving and need to get kicked it should not be possible for them to join as another user should I be able to impersonate or guess another user cryptographically speaking so they are kicked or excluded from the duration of that meeting.  if you need to manage abusive people across meetings that is probably where you would bring in your long-term identity provider. for most people just joining a call because someone emailed them a link you don't need a long-term identity and if you don't need a long-term identity you can do this in a browser. I'm not talking about browser-based crypto or the signing part or whatever because if the cause of Demerol and the IDS ephemeral the web app can be trusted just for the duration of the meeting and we trust web apps just for the duration of whatever activity you were doing all the time and a lot of our stop we're not on the web is moving closer to that sort of bottles all the time Evergreen browsers daily updates to mobile software. I think this can be a good way to look at designing end-to-end encryption protocols and figuring out where we need long-term identity in terms of cryptographic keys and where we jumped and if we don't need long-term identity we don't need to protect  we don't need to protect secret key data in our software platform indefinitely only need to protect it ephemerally then we can do this sort of stuff in the web and if we can do it on the web we can have give access to many many users that desktop apps in mobile apps leave out which I think is a win.


